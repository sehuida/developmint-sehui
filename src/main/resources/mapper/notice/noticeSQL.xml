<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="notice">
	<select id="selectFin" resultType="n">
		select 
			"notice_no" as noticeNo, 
			"notice_title" as noticeTitle, 
			"reg_date" as regDate, 
			"filename" as filename, 
			"filepath" as filepath, 
			"pin"as pin, 
			"notice_writer" as noticeWriter
		from notice where "pin"=2 order by 1 desc
	</select>
	<select id="selectNoticeList" resultType="n" parameterType="cr">
		SELECT NN.* FROM 
		(SELECT ROWNUM AS RNUM, N.* FROM
			(SELECT 
				"notice_no" as noticeNo, 
				"notice_title" as noticeTitle, 
				"reg_date" as regDate,
				"filename" as filename, 
				"filepath" as filepath, 
				"pin"as pin, 
				"notice_writer" as noticeWriter
			FROM notice where "pin" = 1 ORDER BY 1 DESC)N)NN 
		WHERE RNUM BETWEEN #{start} AND #{end}
	</select>
	<select id="totalCount" resultType="_int">
		select count(*)as totalCount from notice
	</select>
	<select id="fixPageCount" resultType="_int">
		select count(*)as fixPageCount from notice where "pin"=2
	</select>
	<select id="selectOneNotice" parameterType="_int" resultType="n">
		select
			"notice_no" as noticeNo, 
			"notice_title" as noticeTitle,
			"notice_content" as noticeContent, 
			"reg_date" as regDate, 
			"filename" as filename, 
			"filepath" as filepath, 
			"pin"as pin, 
			"notice_writer" as noticeWriter 
		from notice where "notice_no" = #{noticeNo }
	</select>
	<select id="noticeAroundList" parameterType="_int" resultType="n">
		select
		    "notice_no" as noticeNo, 
		    "notice_title" as noticeTitle,
		    "reg_date" as regDate
		<![CDATA[
		from notice where "notice_no" between (#{noticeNo}-2) and (#{noticeNo}+2)
		]]>
	</select>
	<insert id="insertNotice" parameterType="n" >
		<choose>
			<when test="pin == 2">
				INSERT INTO NOTICE VALUES(NOTICE_SEQ.NEXTVAL,#{noticeTitle},#{noticeContent},to_char(sysdate,'yyyy-mm-dd'),#{filename},#{filepath},2,#{noticeWriter})
			</when>
			<otherwise>
				INSERT INTO NOTICE VALUES(NOTICE_SEQ.NEXTVAL,#{noticeTitle},#{noticeContent},to_char(sysdate,'yyyy-mm-dd'),#{filename},#{filepath},1,#{noticeWriter})
			</otherwise>
		</choose>
	</insert>
	<delete id="deleteNoticeNo" parameterType="_int">
		delete from notice where "notice_no" = #{noticeNo}
	</delete>
	<update id="updateNoticeNo" parameterType="n">
		update notice set "notice_title"=#{noticeTitle}, "notice_content"=#{noticeContent},"filename"=#{filename},"filepath"=#{filepath} where "notice_no"=#{noticeNo}
	</update>
	<select id="selectRnum" parameterType="_int" resultType="rn">
		<![CDATA[
		select * from(select ROWNUM as rnum, n.* from(select
    		"notice_no" as noticeNo, 
    		"notice_title" as noticeTitle,
    		"reg_date" as regDate
		from notice order by 1 desc)n) where noticeNo = #{noticeNo}
		]]>
	</select>
	<select id="selectRnumList" parameterType="_int" resultType="rn">
		<![CDATA[
		select * from(select ROWNUM as rnum, n.* from(select "notice_no" as noticeNo, 
		    "notice_title" as noticeTitle,
		    "reg_date" as regDate from notice order by 1 desc)n) 
		where rnum between (#{rnum}-2) and (#{rnum}+2)
		]]>
	</select>
</mapper>
