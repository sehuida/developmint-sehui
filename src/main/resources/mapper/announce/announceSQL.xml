<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="announce">
	<select id="selectAnnounce" parameterType="_int" resultType="a">
		select
			announce_no as announceNo,
			member_no as memberNo,
			company_name as companyName,
			category,
			fields,
			school,
			work_form as workForm,
			announce_title as announceTitle,
			announce_content as announceContent,
			skills,
			money,
			work_place as workPlace,
			end_date as endDate,
			veterans,
			military,
			write_date as writeDate,
			career
		from announcement
		where member_no = #{memberNo}
	</select>
	
	<insert id="insertAnnounce" parameterType="a">
		insert into announcement values(announce_seq.nextval, #{memberNo}, #{companyName}, #{category}, #{fields}, #{school}, #{workForm}
		, #{announceTitle}, #{announceContent}, #{skills}, #{money}, #{workPlace}, #{endDate}, #{veterans}, #{military}, to_char(sysdate,'yyyy-mm-dd'), #{career})
	</insert>
	
	<select id="allAnnounce" resultType="a">
		select
			announce_no as announceNo,
			member_no as memberNo,
			company_name as companyName,
			category,
			fields,
			school,
			work_form as workForm,
			announce_title as announceTitle,
			announce_content as announceContent,
			skills,
			money,
			work_place as workPlace,
			end_date as endDate,
			veterans,
			military,
			write_date as writeDate,
			career
		from announcement
	</select>
	
	<select id="selectOneAnnounce" parameterType="_int" resultType="a">
		select
			announce_no as announceNo,
			member_no as memberNo,
			company_name as companyName,
			a.category,
			fields,
			school,
			work_form as workForm,
			announce_title as announceTitle,
			announce_content as announceContent,
			skills,
			money,
			work_place as workPlace,
			end_date as endDate,
			veterans,
			military,
			write_date as writeDate,
			career,
			filepath
		from announcement a
		join company c using(company_name)
		where announce_no = #{announceNo}
	</select>


	<select id="selectAnnounceView" parameterType="_int" resultType="av">
		select
			announce_no as announceNo,
			member_no as memberNo,
			company_no as companyNo,
			company_name as companyName,
			a.category,
			fields,
			school,
			work_form as workForm,
			announce_title as announceTitle,
			announce_content as announceContent,
			skills,
			money,
			work_place as workPlace,
			end_date as endDate,
			veterans,
			military,
			write_date as writeDate,
			career,
			c.open_date as openDate,
			c.employee,
			c.ceo,
			c.address,
			c.content,
			filepath
		from announcement a
		join company c using(company_name)
		where announce_no = #{announceNo}
	</select>
	
	<update id="updateAnnounce" parameterType="a">
		update announcement set 
			category = #{category},
			fields = #{fields},
			school = #{school},
			work_form = #{workForm},
			career = #{career},
			announce_title = #{announceTitle},
			announce_content = #{announceContent},
			skills = #{skills},
			money = #{money},
			work_place = #{workPlace},
			end_date = #{endDate},
			veterans = #{veterans},
			military = #{military}
			where announce_no = #{announceNo}
	</update>
	
	<delete id="deleteApplication" parameterType="_int">
		delete from application where announce_no = #{announceNo}
	</delete>
	
	<delete id="deleteAnnounce" parameterType="_int">
		delete from announcement where announce_no = #{announceNo}
	</delete>
	
	<select id="selectJobSearchList" parameterType="map" resultType="a">
		select * from
		(select rownum as rnum , r.*
		from (
		select
			announce_no as announceNo,
			member_no as memberNo,
			company_no as companyNo,
			company_name as companyName,
			a.category,
			fields,
			school,
			work_form as workForm,
			announce_title as announceTitle,
			announce_content as announceContent,
			skills,
			money,
			work_place as workPlace,
			end_date as endDate,
			veterans,
			military,
			write_date as writeDate,
			career
		from announcement a
		join company c using(company_name)
		order by 1 desc )r)rr 
		where rnum between #{start} and
		#{end}
		
	</select>
	<select id="announceTotalCount" resultType="_int">
		select count(*) from announcement
	</select>
	
	<select id="selectApplyAnnounce" parameterType="map" resultType="al">
		select * from
		(select rownum as rnum , r.*
		from (
        select
            app_no as appNo,
            status,
            announce_no as announceNo,
            a.member_no as memberNo,
            resume_title as resumeTitle,
            apply_date as applyDate
        from application a
        join resume re using(resume_no)
        order by 1 desc )r)rr
        where rnum between #{start} and #{end} and (status = 1 or status = 2) and announceNo = #{announceNo}
	</select>
	
	<select id="selectApplyAnnounceCount" parameterType="_int" resultType="_int">
		select count(*) from application where announce_no = #{announceNo}
	</select>
	
	<select id="selectCeoResume" parameterType="_int" resultType="r">
		select
			resume_no as resumeNo,
			member_no as memberNo,
			resume_title as resumeTitle,
			write_date as writeDate
		from resume
		where member_no = #{memberNo}
		and ceo_resume = 1
	</select>
	
	<!-- <select id="selectResumeNo" parameterType="_int" resultType="_int">
		select
			resume_no as resumeNo
		from application where announce_no = #{announceNo}
	</select> -->
	
	<insert id="insertApplication" parameterType="app">
		insert into application values(app_seq.nextval, #{announceNo}, #{resumeNo}, #{memberNo}, #{status}, to_char(sysdate,'yyyy-mm-dd'))
	</insert>
	
	<select id="selectAnnounceCount" parameterType="_int" resultType="_int">
		select count(*) from application where announce_no = #{announceNo}
	</select>
	
	<select id="selectAllAnnounceCount" resultType="_int">
		select count(*) from announcement
	</select>
	
</mapper>
